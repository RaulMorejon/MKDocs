<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Sprint 3 - Raúl Morejón</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Sprint 3";
        var mkdocs_page_input_path = "sprint3.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Raúl Morejón
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Inici</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Sprints</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../sprint1/">Sprint 1</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sprint2/">Sprint 2</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Sprint 3</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#1-installacio-del-domini-ldap">1. Instal·lació del domini LDAP</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#installacio-de-slapd">Instal·lació de Slapd</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuracio-de-slapd">Configuració de Slapd</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuracio-dels-fitxers-ldif">Configuració dels fitxers .ldif</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#fitxer-uoldif">Fitxer uo.ldif</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#fitxer-grupldif">Fitxer grup.ldif</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#fitxer-usuldif">Fitxer usu.ldif</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#2-unir-equips-al-domini">2. Unir equips al domini</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#installacio-de-nscd">Instal·lació de nscd</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#installacio-de-libnss-ldap">Instal·lació de libnss-ldap</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#installacio-de-libpam-ldap">Instal·lació de libpam-ldap</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuracio-etcnsswitchconf">Configuració /etc/nsswitch.conf</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuracio-etcpamdcommon-password">Configuració /etc/pam.d/common-password</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuracio-etcpamdcommon-session">Configuració /etc/pam.d/common-session</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuracio-de-50-ubuntuconf">Configuració de 50-ubuntu.conf</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#connexio-amb-un-usuari-de-lequip">Connexió amb un usuari de l'equip</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#3-gestio-domini-amb-comandes">3. Gestió Domini amb comandes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#comanda-per-agregar">Comanda per Agregar</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#creacio-duna-nova-ou">Creació d'una nova OU</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#crear-un-nou-usuari-amb-dos-atributs-opcionals-per-a-la-classe-posixaccount">Crear un nou usuari amb dos atributs opcionals per a la classe posixAccount</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#crear-un-nou-grup-dintre-de-la-ou-groups-i-afegir-3-usuaris">Crear un nou grup dintre de la OU Groups i afegir 3 usuaris</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#comanda-per-buscar">Comanda per Buscar</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#quantes-ou-hi-ha-quants-usuaris-hi-ha-al-domini">Quantes OU hi ha? Quants usuaris hi ha al domini?</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#lusuari-kvaughan-en-quants-grups-el-trobem-com-a-uniquemember-i-quins-son">L’usuari kvaughan en quants grups el trobem com a uniqueMember i quins són?</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#quants-grups-hi-ha-dintre-de-la-uo-groups">Quants grups hi ha dintre de la uo Groups?</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#mostra-tots-els-usuaris-del-domini-on-el-seu-uidnumber-estigui-entre-1010-i-1030-inclosos">Mostra tots els usuaris del domini on el seu uidNumber estigui entre 1010 i 1030 (inclosos).</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#usuaris-on-el-seu-telefon-acabi-en-un-2-o-el-seu-cognom-en-una-n-quants">Usuaris on el seu telèfon acabi en un 2 o el seu cognom en una n. Quants?</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#comanda-per-modificar">Comanda per modificar</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#afegir-atribut-opcional-a-lusuari-pedro">Afegir atribut opcional a l’usuari Pedro</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#esborrar-latribut-roomnumber-i-homedirectory-de-lusuari-ejohnson">Esborrar l’atribut roomNumber i homeDirectory de l’usuari ejohnson</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#trau-de-la-uo-people-a-3-usuaris-i-afegeix-los-a-la-uo-dam">Trau de la UO People a 3 usuaris i afegeix-los a la UO DAM</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#esborra-la-uo-people">Esborra la UO People</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#modifica-el-uid-de-lusuari-hmiller-a-hamiller">Modifica el uid de l'usuari hmiller a hamiller</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#dun-sol-cop-a-lusuari-que-tu-vulguis-esborra-un-atribut-afegeix-ne-un-altre-i-modifica-un-tercer">D’un sol cop, a l’usuari que tu vulguis, esborra un atribut, afegeix-ne un altre i modifica un tercer.</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#4-entorns-grafics-apache-directory-studio">4. Entorns Gràfics (Apache Directory Studio)</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#installacio">Instal·lació</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuracio">Configuració</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#1-connexio-a-un-servidor-ldap">1. Connexió a un servidor LDAP</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#2-configuracio-de-la-cerca-a-ldap">2. Configuració de la cerca a LDAP</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#3-configuracio-de-preferencies-generals">3. Configuració de preferències generals</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#comprovar-que-larbre-de-directori-es-correcte">Comprovar que l'arbre de directori és correcte</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#crea-una-uo-un-grup-i-un-usuari">Crea una UO, un Grup i un Usuari</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#1-crear-una-unitat-organitzativa-ou">1. Crear una Unitat Organitzativa (OU)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#2-crear-un-grup">2. Crear un Grup</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#3-crear-un-usuari">3. Crear un Usuari</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#accedir-des-del-client-amb-aquest-usuari">Accedir des del client amb aquest usuari</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#1-configuracio-de-la-connexio">1. Configuració de la connexió</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#2-validar-usuari">2. Validar usuari</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#5-servidor-nfs">5. Servidor NFS</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#installacio-i-configuracio-servidors-ldap">Instal·lació i configuració servidors LDAP</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#installacio-i-configuracio-del-client-windows-11">Instal·lació i configuració del client Windows 11</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#compartir-carpeta-a-windows-11">Compartir carpeta a Windows 11</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#installacio-i-configuracio-del-client-a-ubuntu">Instal·lació i configuració del client a Ubuntu</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#perfils-mobils-a-ubuntu">Perfils mobils a Ubuntu</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#samba">SAMBA</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#nfs">NFS</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sprint4/">Sprint 4</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sprint5/">Sprint 5</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../permisos/">Polítiques d'ús i contacte</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Raúl Morejón</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Sprints</li>
      <li class="breadcrumb-item active">Sprint 3</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="gestio-de-dominis-i-accessos">Gestió de Dominis i Accessos</h1>
<p>La <strong>Gestió de Dominis i Accessos</strong> és el procés d’administrar els permisos i els drets d'accés dels usuaris a recursos i sistemes dins d’un domini, assegurant la seguretat i el control de la informació. Inclou la creació, modificació i eliminació d’usuaris, així com la definició de polítiques d'autorització.</p>
<p>També hem de saber que una <strong>Unitat Organitzativa (UO)</strong> és una estructura lògica per organitzar i gestionar usuaris, grups, recursos i permisos, sovint vinculada a dominis o serveis com LDAP. Aquesta agrupació facilita l'administració centralitzada i el control d'accés en entorns corporatius.</p>
<h2 id="1-installacio-del-domini-ldap">1. Instal·lació del domini LDAP</h2>
<p>Primer de tot, el que caldran seran dues màquines virtuals amb <strong>Ubuntu Desktop</strong>. Una s'encarregarà de ser el <strong>servidor</strong> i l'altra actuarà com a <strong>client</strong>.</p>
<p>Una vegada tenim les dues màquines, configurem la xarxa de cada una en <strong>Xarxa NAT</strong>.</p>
<p><img alt="xarxa nat" src="../img/3-2.png" /></p>
<p>Per començar, anirem a la màquina virtual que farà com a <strong>Servidor</strong>, i mirarem la seva <strong>IP</strong> amb <code>ip a</code>:</p>
<p><img alt="ip a" src="../img/3-1.png" /></p>
<p>La nostra <strong>IP</strong> en aquest cas serà <code>10.0.2.15</code> en el <strong>Servidor</strong>. A continuació, configurem la xarxa del nostre sistema de la següent manera:</p>
<p><img alt="xarxa" src="../img/3-3.png" /></p>
<p>Per comprovar la connexió, utilitzem la comanda <code>ping</code> amb el <strong>DNS</strong> que és <code>8.8.8.8</code>:</p>
<p><img alt="ping dns" src="../img/3-1.png" /></p>
<p>Després de tot, anem al fitxer <code>/etc/hosts</code> on introduirem la nostra <strong>IP</strong> d'abans seguida del nostre <strong>host name</strong> i <strong>domini</strong> de la següent manera:</p>
<p><img alt="/etc/hosts" src="../img/3-5.png" /></p>
<ul>
<li>
<h4 id="installacio-de-slapd">Instal·lació de Slapd</h4>
<p>Fem ús de <code>apt install slapd ldap-utils</code> per instal·lar el paquet i primerament ens portarà a la següent finestra:</p>
<p><img alt="slapd 1" src="../img/3-6.png" /></p>
<p>En aquesta finestra hem d'introduir la contrasenya que ens permet entrar a <strong>slapd</strong> com a administrador. 
Li donem a <strong>Acceptar</strong> i en la següent finestra que ens surt confirmem la contrasenya introduïda:</p>
<p><img alt="slapd 2" src="../img/3-7.png" /></p>
<p>Un altre cop donem a <strong>Acceptar</strong> i finalment, si tot va bé, tindrem la instal·lació finalitzada amb èxit.</p>
<p><img alt="slapd 3" src="../img/3-8.png" /></p>
</li>
</ul>
<p>Un cop fet el pas anterior, executem la comanda <code>slapcat</code> i ens mostrarà una sèrie d'informació que és tota aquella referent a <strong>LDAP</strong>, que s'utilitza per accedir i gestionar informació en serveis de directoris, com usuaris i recursos dins d'una xarxa.</p>
<p><img alt="comanda slapd" src="../img/3-9.png" /></p>
<p>Seguidament, hem de tenir una sèrie d'arxius que hem descarregat amb antelació. En aquest cas els tenim ja en un comprimit <strong>ZIP</strong> a la carpeta <strong>Descàrregues</strong>, així que anem i el descomprimim al directori de la següent manera:</p>
<p><img alt="unzip" src="../img/3-11.png" /></p>
<p>Obtenim cinc fitxers dels quals un és el <strong>fitxer base</strong>, que en LDAP conté la configuració inicial d’un domini o directori. Es fa servir per inicialitzar la base de dades LDAP abans d'afegir-hi més dades. Es pot fer pel <strong>fitxer base</strong> o, com veurem a continuació, per comandes.</p>
<ul>
<li>
<h4 id="configuracio-de-slapd">Configuració de Slapd</h4>
<p>Ara configurem el servei <strong>LDAP</strong> amb la comanda <code>dpkg-reconfigure slapd</code>:</p>
<p><img alt="dpkg" src="../img/3-12.png" /></p>
<p>Primer de tot s'obrirà una finestra on hem de seleccionar l'opció de <strong>NO</strong> per continuar amb la configuració.</p>
<p><img alt="dpkg 1" src="../img/3-13.png" /></p>
<p>Seguidament hem d'introduir el nom que havíem posat del nostre <strong>host</strong> amb el <strong>domini</strong> del <strong>DNS</strong>, en aquest cas serà <code>raul.cat</code>, i donem a <strong>Acceptar</strong>.</p>
<p><img alt="dpkg 2" src="../img/3-14.png" /></p>
<p>En una altra finestra ens demanen el <strong>Nom de l'organització</strong> que estem creant, i en aquest cas serà igual que abans: <code>raul.cat</code>:</p>
<p><img alt="dpkg 3" src="../img/3-15.png" /></p>
<p>En la següent finestra que ens sortirà ens demanaran la contrasenya de l'administrador per accedir al directori <strong>LDAP</strong>:</p>
<p><img alt="dpkg 4" src="../img/3-16.png" /></p>
<p>Confirmació de la contrasenya:</p>
<p><img alt="dpkg 5" src="../img/3-17.png" /></p>
<p>En la nova finestra que sortirà a continuació hem de donar a l'opció de <strong>SI</strong>:</p>
<p><img alt="dpkg 6" src="../img/3-18.png" /></p>
<p>I finalment, en l'última finestra hem de seleccionar l'opció de <strong>SI</strong>:</p>
<p><img alt="dpkg 7" src="../img/3-19.png" /></p>
<p>I ja tindríem creat el directori de <strong>LDAP</strong> amb totes les configuracions.</p>
<p><img alt="dpkg 8" src="../img/3-20.png" /></p>
</li>
</ul>
<p>Ara tornem a utilitzar la comanda <code>slapcat</code> i veiem que respecte al d'abans ara s'han actualitzat els noms de l'organització i el domini.</p>
<p><img alt="slapcat nou" src="../img/3-21.png" /></p>
<p>Breument, la informació vol dir el següent:</p>
<ol>
<li><strong><code>dn: dc=hostname,dc=domini</code></strong>: Identificador únic de l'entrada LDAP.</li>
<li><strong><code>objectClass: top</code></strong>: Classe d'objecte bàsica per a totes les entrades.</li>
<li><strong><code>objectClass: domain</code></strong>: Indica que l'entrada és un domini LDAP.</li>
<li><strong><code>dc: exemple</code></strong>: Component del domini (<code>exemple</code>) dins de l'arbre LDAP.</li>
</ol>
<h4 id="configuracio-dels-fitxers-ldif">Configuració dels fitxers .ldif</h4>
<p>En aquest moment anirem configurant els fitxers que havíem descarregat abans. Aquests fitxers es troben al directori <strong>Descàrregues</strong> i contenen la configuració inicial d’un domini o directori del <strong>LDAP</strong>.</p>
<ul>
<li>
<h5 id="fitxer-uoldif">Fitxer uo.ldif</h5>
<p>Aquest fitxer inclou una entrada per definir la UO <strong>(ou=Users)</strong> i una altra per cada usuari amb atributs. Això s'utilitza per gestionar estructures i comptes del servidor LDAP.</p>
<ul>
<li>En el apartat de <strong><code>dc</code></strong> posem el nom del <strong>host</strong>, i en <strong><code>dc</code></strong> posem el domini.</li>
<li><strong><code>ou</code></strong> seria la <strong>Unitat Organitzativa</strong></li>
</ul>
<p><img alt="uo.ldif" src="../img/3-22.png" /></p>
</li>
<li>
<h5 id="fitxer-grupldif">Fitxer grup.ldif</h5>
<p>El fitxer <strong>grup.ldif</strong> és un fitxer en format LDIF utilitzat per definir i gestionar grups dins d'un directori LDAP. Aquest fitxer pot contenir les definicions de grups, incloent-hi els seus noms, membres i altres atributs relacionats.</p>
<ul>
<li><strong><code>PosixAccount</code></strong> representa comptes d'usuari i es fa servir per a la informació d'usuaris individuals.</li>
<li><strong><code>PosixGroup</code></strong> representa grups d'usuaris, amb atributs com <code>cn</code>, <code>gidNumber</code> i <code>memberUid</code> per definir els membres del grup. S'utilitza per agrupar usuaris en un mateix grup.
Els usuaris poden estar associats a un grup a través del <strong><code>gidNumber</code></strong> i els membres de cada grup es llisten amb <strong><code>memberUid</code></strong>.</li>
</ul>
<p>Igual que en el fitxer anterior, posarem el nostre <strong>host</strong> corresponent i el domini. També posarem el nom del <strong><code>memberUid</code></strong> que serà <code>alu1</code>:</p>
<p><img alt="grup.ldif" src="../img/3-23.png" /></p>
</li>
<li>
<h5 id="fitxer-usuldif">Fitxer usu.ldif</h5>
<p>Finalment, editarem el fitxer <strong>usu.ldif</strong> que s'utilitza per definir un compte d'usuari en un directori LDAP, incloent-hi atributs com <code>uid</code>, <code>homeDirectory</code>, <code>userPassword</code> i altres informació relacionada amb el compte.</p>
<p>El que s'ha de canviar és el <strong>host</strong> i el <strong>domini</strong> pel nostre. I si es vol, es pot canviar la contrasenya en <code>userPassword</code>:</p>
<p><img alt="usu.ldif" src="../img/3-24.png" /></p>
</li>
</ul>
<p>Una vegada hem editat tots els fitxers anteriors, hem d'executar la comanda <code>ldapadd -c -x -D "cn=admin,dc=raul,dc=cat" -W -f uo.ldif</code></p>
<p>S'utilitza per afegir entrades a un directori LDAP i es divideix en les següents parts:</p>
<ul>
<li><strong><code>ldapadd</code></strong>: És l'eina per afegir entrades al directori LDAP.</li>
<li><strong><code>-c</code></strong>: Manté les sortides d'errors en pantalla, mostrant més informació de la comanda.</li>
<li><strong><code>-x</code></strong>: Utilitza un mode simplificat de connexió sense autenticació de seguretat.</li>
<li><strong><code>-D "cn=admin,dc=raul,dc=cat"</code></strong>: Especifica el DN de l'usuari que s'autentica, en aquest cas, un usuari admin.</li>
<li><strong><code>-W</code></strong>: Demana la contrasenya per a l'usuari <code>cn=admin</code>.</li>
<li><strong><code>-f uo.ldif</code></strong>: Indica el fitxer que conté les dades a afegir al directori.</li>
</ul>
<p><img alt="ldapadd" src="../img/3-25.png" /></p>
<p>I després d'utilitzar la comanda anterior s'afegeix totes les dades al directori.</p>
<p>Seguidament fem el mateix per als altres dos fitxers:</p>
<p><img alt="ldapadd" src="../img/3-26.png" /></p>
<p>Ara sí, ja tindríem tota la informació agregada tant d'usuaris, grups com l'estructura.</p>
<p>Finalment fem ús de la comanda <code>slapcat</code> per veure que les entrades de la base de dades del directori han canviat, i s'ha afegit la informació corresponent als fitxers anteriors.</p>
<p><img alt="slapcat actualitzat" src="../img/3-27.png" /></p>
<hr />
<h2 id="2-unir-equips-al-domini">2. Unir equips al domini</h2>
<p>En aquest punt hem d'anar a una altra màquina virtual sense tancar la que tenim que fa com a <strong>server</strong>. Obrim la màquina virtual que actua com a <strong>client</strong> i mirem la seva <strong>IP</strong> amb <code>ip a</code>.</p>
<p>Seguidament comprovem que tenim connexió amb el <strong>Server</strong> fent un <code>ping 10.0.2.15</code>, que és la <strong>IP</strong> del server. Podem veure que sí tenim connexió.</p>
<p><img alt="ipaclient" src="../img/3-28.png" /></p>
<h4 id="installacio-de-nscd">Instal·lació de nscd</h4>
<p>Fem la instal·lació del paquet <code>nscd</code> que emmagatzema en memòria les consultes a serveis de noms per millorar el rendiment i reduir la càrrega del sistema.</p>
<p><img alt="nscd" src="../img/3-29.png" /></p>
<h4 id="installacio-de-libnss-ldap">Instal·lació de libnss-ldap</h4>
<p>També hem de fer la instal·lació de <code>libnss-ldap</code> que permet la integració de serveis LDAP amb el sistema de noms de serveis, permetent que els usuaris i grups siguin gestionats a través d'un servidor LDAP.</p>
<p><img alt="libnss-lap" src="../img/3-30.png" /></p>
<p>Quan li donem a <code>S</code> per seguir amb la instal·lació, ens sortirà una sèrie de finestres per configurar.</p>
<ul>
<li>
<p>En la primera finestra ens trobem que hem d'introduir la <strong>IP</strong> del server de la següent manera:</p>
<p><img alt="libnss 1" src="../img/3-31.png" /></p>
</li>
<li>
<p>En la següent finestra hem de canviar la configuració de l'autor i posar el nostre <strong>hostname</strong> seguit de nou del <strong>domini</strong> de la següent manera:</p>
<p><img alt="libnss 2" src="../img/3-32.png" /></p>
</li>
<li>
<p>En una nova finestra seleccionem la versió de <strong>LDAP</strong> més recent, en aquest cas la que ve seleccionada per defecte, que és la <strong>3</strong>:</p>
<p><img alt="libnss 3" src="../img/3-33.png" /></p>
</li>
<li>
<p>I en la següent finestra seleccionem l'opció de <strong>SI</strong>:</p>
<p><img alt="libnss 4" src="../img/3-34.png" /></p>
</li>
<li>
<p>Seleccionem l'opció de <strong>NO</strong> per no requerir un inici de sessió per la base de dades de <strong>LDAP</strong>:</p>
<p><img alt="libnss 5" src="../img/3-35.png" /></p>
</li>
<li>
<p>En la següent finestra hem de posar les dades de <strong>host</strong> i <strong>domini</strong> per al <strong>Admin</strong>:</p>
<p><img alt="libnss 6" src="../img/3-36.png" /></p>
</li>
<li>
<p>Finalment hem d'introduir la contrasenya del <strong>LDAP</strong>:</p>
<p><img alt="libnss 7" src="../img/3-37.png" /></p>
</li>
</ul>
<p>I després de tots els passos ja tindríem feta tota la configuració de <code>libnss-ldap</code>.</p>
<p>En cas que en <strong>algun moment</strong> vulguem reconfigurar els passos anteriors, el que farem serà executar la comanda <code>dpkg-reconfigure ldap-auth-config</code> i tornarem a la primera finestra d'aquesta configuració:</p>
<p><img alt="reconfigurar" src="../img/3-39.png" /></p>
<h4 id="installacio-de-libpam-ldap">Instal·lació de libpam-ldap</h4>
<p>Fem la instal·lació de <code>libpam-ldap</code>, que és una biblioteca que permet autenticar usuaris mitjançant un servidor LDAP, en lloc de fer-ho amb fitxers locals. </p>
<p>S'integra amb el sistema PAM per gestionar l'accés als recursos del sistema de manera centralitzada. Així, els usuaris poden accedir a diversos sistemes amb una sola identitat gestionada a LDAP.</p>
<p><img alt="libpam-ldap" src="../img/3-38.png" /></p>
<h4 id="configuracio-etcnsswitchconf">Configuració <code>/etc/nsswitch.conf</code></h4>
<p>Anirem al fitxer de configuració <code>/etc/nsswitch.conf</code>, que configura l'ordre en què el sistema cerca fonts d'informació per resoldre serveis com usuaris, grups, noms d'amfitrió, etc.
En aquest cas, mirar primer els usuaris creats.</p>
<p>En aquest fitxer hem d'agregar <code>compat files</code> en els atributs de <code>passwd</code>, <code>group</code> i <code>gshadow</code>:</p>
<p><img alt="nsswitch.conf" src="../img/3-40.png" /></p>
<h4 id="configuracio-etcpamdcommon-password">Configuració <code>/etc/pam.d/common-password</code></h4>
<p>Anem al fitxer <code>/etc/pam.d/common-password</code>, que és un fitxer de configuració que defineix les polítiques i els mòduls relacionats amb la gestió de contrasenyes per als sistemes que utilitzen PAM.</p>
<p>Mirem que tinguem posat l'<code>use_authtok</code>; en versions anteriors no ve posat així que l'hauríem d'agregar:</p>
<p><img alt="common-password" src="../img/3-41.png" /></p>
<h4 id="configuracio-etcpamdcommon-session">Configuració <code>/etc/pam.d/common-session</code></h4>
<p>Ara haurem d'agregar una línia al fitxer <code>/etc/pam.d/common-session</code>, que és un fitxer que forma part de la configuració de PAM. Serveix per definir regles comunes que gestionen l'inici i el tancament de les sessions d'usuari.</p>
<p>Afegim la línia <code>session optional pam_mkhomedir.so skel=/etc/skel unmask=077</code> que crea automàticament el directori personal d'un usuari quan inicia sessió per primera vegada, si aquest no existeix, en el moment que aquest inicia sessió. Aquesta opció és <strong>opcional</strong> i només s'executa si el servei ho permet.</p>
<ul>
<li><strong><code>pam_mkhomedir.so</code></strong>: Mòdul que crea directoris personals.</li>
<li><strong><code>skel=/etc/skel</code></strong>: Indica que els fitxers i directoris de <code>/etc/skel</code> s'utilitzen com a plantilla per inicialitzar el directori personal.</li>
<li><strong><code>umask=077</code></strong>: Estableix permisos restrictius per defecte (només l'usuari té accés complet al seu directori personal).</li>
</ul>
<p><img alt="common-session" src="../img/3-42.png" /></p>
<h4 id="configuracio-de-50-ubuntuconf">Configuració de <code>50-ubuntu.conf</code></h4>
<p>Anem al fitxer <code>/usr/share/lightdm/lightdm.conf.d/50-ubuntu.conf</code>, que configura <strong>LightDM</strong> a Ubuntu, definint opcions predeterminades com el greeter i la sessió d'escriptori. Sent <strong>greeter</strong> la interfície gràfica que mostra el gestor d'inici de sessió per permetre als usuaris introduir les seves credencials i iniciar sessió al sistema.</p>
<p>Dins del fitxer afegim la línia <code>greeter-show-manual-login=true</code>, que habilita l'opció per introduir manualment el nom d'usuari i la contrasenya a la pantalla d'inici de sessió.</p>
<p><img alt="manual log" src="../img/3-43.png" /></p>
<h4 id="connexio-amb-un-usuari-de-lequip">Connexió amb un usuari de l'equip</h4>
<p>Finalment farem una cerca al fitxer <code>passwd</code> de l'usuari <code>alu1</code> creat durant tot aquest procés. Si el veiem, és que els passos anteriors han anat bé.</p>
<p><img alt="passwd" src="../img/3-44.png" /></p>
<p>I podem connectar-nos correctament amb l'usuari creat:</p>
<p><img alt="connectar" src="../img/3-45.png" /></p>
<p>Seguidament el que farem serà fer un <code>reboot</code> de la màquina i introduirem el nom de l'usuari i la seva contrasenya.</p>
<p>Usuari <code>alu1</code>:</p>
<p><img alt="Usuari" src="../img/3-46.png" /></p>
<p>Contrasenya <code>alu1</code>:</p>
<p><img alt="Contrasenya" src="../img/3-47.png" /></p>
<p><em>Home</em> de l'usuari:</p>
<p><img alt="Home" src="../img/3-48.png" /></p>
<hr />
<h2 id="3-gestio-domini-amb-comandes">3. Gestió Domini amb comandes</h2>
<p>Primer de tot hem de fer ús de la comanda <code>dpkg-reconfigure slapd</code> al servidor per tal de deixar la base de dades buida i només amb el domini i l’usuari admin creat.</p>
<p>Quan hàgim executat deixem tot com estava predeterminat però en les següents finestres seleccionem l'opció de <strong>SI</strong>:</p>
<p><img alt="finestra1" src="../img/3-50.png" /></p>
<p><img alt="finestra2" src="../img/3.51.png" /></p>
<p>Seguidament hem de descarregar un arxiu <code>.ldif</code> i amb la comanda <code>ldapadd</code> haurem de carregar els <strong>usuaris, grups i uos</strong>.</p>
<p><img alt="descarregar" src="../img/3-49.png" /></p>
<p>Una vegada tenim l'arxiu descarregat hem d'accedir a ell per interfície gràfica, anem a l'esquina superior dreta i al menú desplegable anem a <strong>Buscar i Substituir</strong>.</p>
<p><img alt="Buscar i Substituir" src="../img/3.52.png" /></p>
<p>Dins reemplaçarem <code>dc=miquel,dc=com</code> per <code>dc=raul,dc=cat</code>, quan li donem a aplicar es reemplaçarà a tot el document:</p>
<p><img alt="remplaçarem" src="../img/3.53.png" /></p>
<h3 id="comanda-per-agregar">Comanda per Agregar</h3>
<p>Després de tot hem de carregar-los al <strong>LDAP</strong>, llavors hem de posar la comanda <code>ldapadd -x -D "cn=admin,dc=raul,dc=cat" -W -f dades.ldif</code> que afegeix entrades al directori <strong>LDAP</strong>.
La comanda anterior es divideix en: </p>
<ol>
<li><strong><code>ldapadd</code></strong>: Afegeix entrades al directori LDAP.  </li>
<li><strong><code>-x</code></strong>: Utilitza autenticació simple.  </li>
<li><strong><code>-D "cn=admin,dc=raul,dc=cat"</code></strong>: Especifica l'usuari (DN) que s'autenticarà.  </li>
<li><strong><code>-W</code></strong>: Demana la contrasenya de l'usuari de manera interactiva.  </li>
<li><strong><code>-f dades.ldif</code></strong>: Indica l'arxiu LDIF amb les dades a afegir.</li>
</ol>
<p>Llistat d'entrades afegides:</p>
<p><img alt="agregar" src="../img/3.54.png" /></p>
<h4 id="creacio-duna-nova-ou">Creació d'una nova OU</h4>
<p>En aquest apartat farem la creació d'una nova <strong>OU</strong>, en aquest cas, anomenada <strong>Dam</strong>. Per crear-la anirem al fitxer i agregarem una nova de la següent manera fent-la com a <code>organizationalUnit</code>:</p>
<p><img alt="creació ou" src="../img/3.56.png" /></p>
<p>Guardem el fitxer i seguidament pugem els canvis al servidor <strong>LDAP</strong> amb <code>ldapadd</code>.</p>
<p><img alt="add" src="../img/3.57.png" /></p>
<p>I comprovem que estiguin els canvis:</p>
<p><img alt="search" src="../img/3.58.png" /></p>
<h4 id="crear-un-nou-usuari-amb-dos-atributs-opcionals-per-a-la-classe-posixaccount">Crear un nou usuari amb dos atributs opcionals per a la classe posixAccount</h4>
<p>Crearem un nou usuari amb la següent informació:</p>
<p><img alt="user" src="../img/3.61.png" /></p>
<p>Els atributs <code>telephoneNumber, mail</code> són opcionals per a la classe <code>posixAccount</code>, els altres són obligatoris.</p>
<p>El tornem a agregar a <strong>LDAP</strong>: </p>
<p><img alt="add" src="../img/3.60.png" /></p>
<h4 id="crear-un-nou-grup-dintre-de-la-ou-groups-i-afegir-3-usuaris">Crear un nou grup dintre de la OU Groups i afegir 3 usuaris</h4>
<p>Per crear un nou grup anomenat <strong>nouGrup</strong> a la <code>ou=Groups</code> i afegir 3 usuaris a la vegada el que farem serà introduir la següent informació al nostre fitxer que es divideix en els següents components:</p>
<ol>
<li><strong><code>dn</code></strong>: Defineix el distingit nom del nou grup (cn=nouGrup dins de la OU Groups).</li>
<li><strong><code>objectClass</code></strong>: Defineix els tipus d'objecte:</li>
<li><strong><code>top</code></strong>: Classe bàsica.</li>
<li><strong><code>groupOfNames</code></strong>: Classe per grups que contenen membres identificats per DN.</li>
<li><strong><code>cn</code></strong>: Nom del grup, en aquest cas, nouGrup.</li>
<li><strong><code>description</code></strong>: Descripció opcional del grup.</li>
<li><strong><code>member</code></strong>: Llista d'usuaris (DN complet de cada usuari).</li>
</ol>
<p><img alt="grup nou" src="../img/3.67.png" /></p>
<p>A continuació l'afeixim al <strong>LDAP</strong> amb <code>ldapadd</code>:</p>
<p><img alt="add" src="../img/3.66.png" /></p>
<p>I comprovem que s'hagi afegit correctament de la següent manera:</p>
<p><img alt="search" src="../img/3.65.png" /></p>
<h3 id="comanda-per-buscar">Comanda per Buscar</h3>
<p>La comanda <code>ldapsearch -xLLL -b "dc=raul,dc=cat" dn</code> fa una consulta al directori <strong>LDAP</strong> per obtenir els <strong>DN</strong> de les entrades sota el domini especificat. 
Parts de la comanda: </p>
<ol>
<li><strong><code>ldapsearch</code></strong>: Cerca informació al directori <strong>LDAP</strong>.  </li>
<li><strong><code>-x</code></strong>: Usa autenticació simple.  </li>
<li><strong><code>-LLL</code></strong>: Mostra la sortida sense informació extra (format net).  </li>
<li><strong><code>-b "dc=raul,dc=cat"</code></strong>: Defineix la base de cerca dins del domini <code>raul.cat</code>.  </li>
<li><strong><code>dn</code></strong>: Sol·licita només els <strong>DN</strong> de les entrades. </li>
</ol>
<p>Llistat de <strong>DN</strong> de cada entrada: </p>
<p><img alt="fitxer-ldif" src="../img/3.55.png" /></p>
<h4 id="quantes-ou-hi-ha-quants-usuaris-hi-ha-al-domini">Quantes <strong>OU</strong> hi ha? Quants <strong>usuaris</strong> hi ha al domini?</h4>
<p>Per buscar la quantitat de <strong>OU</strong> que hi ha farem ús de la següent comanda que filtrarà per <strong>Unitat Organitzativa</strong>:</p>
<p><code>ldapsearch -x -D "cn=admin,dc=raul,dc=cat" -W -b "dc=raul,dc=cat" "(objectClass=organizationalUnit)"</code>. </p>
<p>El resultat és de 5 <strong>OU</strong>:</p>
<p><img alt="ous" src="../img/3.68.png" /></p>
<p>Per buscar la quantitat d'<strong>Usuaris</strong> que hi ha farem ús de la següent comanda que filtrarà per <strong>Persones</strong>:</p>
<p><code>ldapsearch -x -D "cn=admin,dc=raul,dc=cat" -W -b "dc=raul,dc=cat" "(objectClass=person)"</code></p>
<p>Resultat de 151 Usuaris:</p>
<p><img alt="Usuaris" src="../img/3.69.png" /></p>
<h4 id="lusuari-kvaughan-en-quants-grups-el-trobem-com-a-uniquemember-i-quins-son">L’usuari <strong>kvaughan</strong> en quants grups el trobem com a uniqueMember i quins són?</h4>
<p>Per trobar-ho, podem fer una cerca dels grups on <strong>kvaughan</strong> aparegui com a membre únic <code>uniqueMember</code>. </p>
<p>Amb la següent comanda treballarem a quants grups pertany, en aquest cas 1 (<code>numResponses: 1</code>): </p>
<p><code>ldapsearch -x -D "cn=admin,dc=raul,dc=cat" -W -b "dc=raul,dc=cat" "(uniqueMember=cn=kvaughan,ou=People,dc=raul,dc=cat)" cn</code>  </p>
<p><img alt="kvaughan" src="../img/3.70.png" /></p>
<h4 id="quants-grups-hi-ha-dintre-de-la-uo-groups">Quants grups hi ha dintre de la uo Groups?</h4>
<p>Per comptar el nombre de grups dins de la unitat organitzativa <strong>Groups</strong> vem usar la següent comanda. En aquest cas, tenim 6 grups:
<code>ldapsearch -xLLL -b "ou=Groups,dc=raul,dc=cat" cn</code></p>
<p><img alt="Groups" src="../img/3.71.png" /></p>
<p>I per comptar-los afegim <code>...| grep -c "^cn"</code> per filtrar pel nom:</p>
<p><img alt="resultat" src="../img/3.72.png" />
<br><br></p>
<h4 id="mostra-tots-els-usuaris-del-domini-on-el-seu-uidnumber-estigui-entre-1010-i-1030-inclosos">Mostra tots els usuaris del domini on el seu uidNumber estigui entre 1010 i 1030 (inclosos).</h4>
<p>Per cercar usuaris amb un uidNumber dins del rang entre 1010 i 1030 hem de fer servir la següent comanda que filtra pel rang i mostra els <strong>dn</strong> de cada usuari inclòs:</p>
<p><code>ldapsearch -xLLL -D "cn=admin,dc=raul,dc=cat" -W -b "dc=raul,dc=cat" "(&amp;(uidNumber&gt;=1010)(uidNumber&lt;=1030))" dn</code></p>
<ul>
<li><strong><code>(&amp;(uidNumber&gt;=1010)(uidNumber&lt;=1030))</code></strong>: Filtra els usuaris amb un <code>uidNumber</code> dins del rang especificat.</li>
</ul>
<p><img alt="uid Inclosos" src="../img/3.94.png" />
<br><br></p>
<h4 id="usuaris-on-el-seu-telefon-acabi-en-un-2-o-el-seu-cognom-en-una-n-quants">Usuaris on el seu telèfon acabi en un 2 o el seu cognom en una n. Quants?</h4>
<p>Per buscar usuaris on el seu telèfon acabi en un 2 o el seu cognom en una n hem de fer servir la següent comanda:
<code>ldapsearch -xLLL -D "cn=admin,dc=raul,dc=cat" -W -b "dc=raul,dc=cat" "(|(telephoneNumber=*2)(sn=*n))" telephoneNumber sn</code></p>
<ol>
<li><strong><code>(|(telephoneNumber=*2)(sn=*n))</code></strong>: Cerca usuaris on el <code>telephoneNumber=*2</code> (el número de telèfon acaba en 2).</li>
<li><strong><code>sn=*n</code></strong>: El cognom acaba en una n.</li>
<li>Filtra per <code>telephoneNumber</code> i <code>sn</code>.</li>
</ol>
<p><img alt="telefon y sn" src="../img/3.95.png" /></p>
<p>Per comptar el número de resultats afegim el filtre: <code>| grep "^dn:" | wc -l</code> que filtra per les línies amb <strong>dn</strong> i les compta:</p>
<p><img alt="resultat" src="../img/3.96.png" /></p>
<p>El resultat és de 48 usuaris que coincideixen amb el filtre.
<br><br></p>
<h3 id="comanda-per-modificar">Comanda per modificar</h3>
<p>La comanda amb l'estructura següent: <code>ldapmodify [opcions] -D "Distinguished Name" -W -f fitxer.ldif</code> serveix per modificar entrades en un directori <strong>LDAP</strong>, permetent afegir, canviar o eliminar atributs d'una entrada existent. 
La comanda es divideix en:</p>
<ol>
<li><strong><code>ldapmodify</code></strong>: Comanda per modificar entrades al directori LDAP.</li>
<li><strong><code>-D "dn"</code></strong>: Especifica l'usuari (DN) que s'autenticarà per realitzar les modificacions.</li>
<li><strong><code>-W</code></strong>: Demana la contrasenya per a l'usuari especificat.</li>
<li><strong><code>-f fitxer.ldif</code></strong>: Indica l'arxiu LDIF que conté les modificacions a aplicar.</li>
<li><strong><code>-x</code></strong>: Usa autenticació simple (sense SASL).
<br><br></li>
</ol>
<h4 id="afegir-atribut-opcional-a-lusuari-pedro">Afegir atribut opcional a l’usuari Pedro</h4>
<p>Per afegir un nou atribut a l'usuari <strong>Pedro</strong>, el que hem de fer primer és afegir les següents línies al fitxer <strong>mk.ldif</strong> que seran les que modificaran l'usuari per afegir-los.</p>
<p><img alt="ldif" src="../img/3.62.png" /></p>
<p>L'agreguem al <strong>LDAP</strong> amb la comanda <code>ldapmodify -x -D "cn=admin,dc=raul,dc=cat" -W -f mk.ldif</code></p>
<p><img alt="modify" src="../img/3.63.png" /></p>
<p>Comprovem que s'ha afegit:</p>
<p><img alt="search" src="../img/3.64.png" />
<br><br></p>
<h4 id="esborrar-latribut-roomnumber-i-homedirectory-de-lusuari-ejohnson">Esborrar l’atribut roomNumber i homeDirectory de l’usuari ejohnson</h4>
<p>Primer de tot hem de comprovar l'estat inicial de l'usuari <strong>ejohnson</strong>. Per això ho mirarem amb la comanda:
<code>ldapsearch -x -b "dc=raul,dc=cat" "(uid=ejohnson)"</code></p>
<p><img alt="Estat inicial" src="../img/3.73.png" /></p>
<p>Anteriorment podem veure que els atributs existeixen, així que si volem eliminar <code>roomNumber</code> i <code>homeDirectory</code> de l'usuari <code>ejohnson</code>, em d'introduir la següent entrada:  </p>
<pre><code class="language-ldif">dn: uid=ejohnson,ou=People,dc=raul,dc=cat
changetype: modify
delete: roomNumber
</code></pre>
<p><img alt="Delete roomNumber" src="../img/3.74.png" /></p>
<p>Explicació de l'entrada anterior:</p>
<ol>
<li><strong><code>dn</code></strong>: Identifica l'usuari (<code>cn=ejohnson</code>).</li>
<li><strong><code>changetype: modify</code></strong>: Especifica que es tracta d'una modificació.</li>
<li><strong><code>delete</code></strong>: Indica que volem esborrar l'atribut <code>roomNumber</code>. </li>
</ol>
<p>Per altra banda, tenim que no ens deixa eliminar directament l'atribut <code>homeDirectory</code> perquè <code>posixAccount</code> depèn d'ell. Llavors, passarem l'atribut a valor <em>NULL</em>, i això eliminarà l'atribut indirectament, amb la següent entrada:</p>
<pre><code class="language-ldif">dn: uid=ejohnson,ou=People,dc=raul,dc=cat
changetype: modify
replace: homeDirectory
homeDirectory: /dev/null
</code></pre>
<ol>
<li><strong><code>replace: homeDirectory</code></strong>: Indica que volem reemplaçar el contingut de l'atribut <code>homeDirectory</code>.</li>
<li><strong><code>homeDirectory: /dev/null</code></strong>: Indica que volem canviar a <em>NULL</em> el seu valor. </li>
</ol>
<p><img alt="homeDirectory null" src="../img/3.75.png" /></p>
<p>Per introduir totes les entrades al <strong>LDIF</strong> hem d'executar la comanda <code>ldapmodify -x -D "cn=admin,dc=raul,dc=cat" -W -f mk.ldif</code> i farà totes les modificacions pertinents.</p>
<p>Finalment, al executar tot l'anterior, farem una cerca a l'usuari <strong>ejohnson</strong> per tornar a veure tota la seva informació i saber si s'ha actualitzat correctament. Llavors, amb la comanda:
<code>ldapsearch -x -b "dc=raul,dc=cat" "(uid=ejohnson)"</code>, podem veure el següent:</p>
<p><strong>Estat final correctament:</strong></p>
<p><img alt="Estat final" src="../img/3.76.png" />
<br><br></p>
<h4 id="trau-de-la-uo-people-a-3-usuaris-i-afegeix-los-a-la-uo-dam">Trau de la UO People a 3 usuaris i afegeix-los a la UO DAM</h4>
<p>Primer de tot, comprovem que no hi ha cap usuari a la <strong>UO</strong> de <strong>DAM</strong> fent una cerca. La comanda cerca tots els usuaris amb <code>objectClass=posixAccount</code> dins de la <strong>UO</strong>:</p>
<p><code>ldapsearch -xLLL -D "cn=admin,dc=raul,dc=cat" -W -b "ou=dam,dc=raul,dc=cat" "(objectClass=posixAccount)"</code></p>
<p>També hem de mirar que existeix la <strong>Unitat Organitzativa</strong> de <strong>DAM</strong>, fent una simple cerca trobem que existeix:<br />
<code>ldapsearch -xLLL -D "ou=dam,dc=raul,dc=cat"</code></p>
<p><img alt="usuaris dam" src="../img/3.77.png" /></p>
<p>Seguidament, hem de mirar els usuaris que tenim a <strong>People</strong> amb la següent comanda que ens retorna el <strong>dn</strong> de cada usuari:</p>
<p><code>ldapsearch -xLLL -D "cn=admin,dc=raul,dc=cat" -W -b "ou=People,dc=raul,dc=cat" "(objectClass=posixAccount)" dn</code></p>
<p><img alt="usuaris people" src="../img/3.78.png" /></p>
<p>El que farem serà passar els tres primers usuaris de <strong>People</strong> a la <strong>UO</strong> de <strong>DAM</strong>. Llavors, hem d'introduir la següent entrada al fitxer <strong>ldif</strong>:</p>
<p>On cada línia es divideix en els següents arguments:</p>
<ol>
<li><strong><code>dn:</code></strong> Especifica el DN actual de l'usuari a la unitat <code>ou=People</code>.</li>
<li><strong><code>changetype:</code></strong> Indica que es vol modificar el DN (amb el tipus de canvi: <code>moddn</code>).</li>
<li><strong><code>newrdn:</code></strong> Defineix el nou RDN, que en aquest cas no canvia.</li>
<li><strong><code>deleteoldrdn:</code></strong> Esborra el RDN antic; valor <code>1</code> indica que sí.</li>
<li><strong><code>newSuperior:</code></strong> Mou l'entrada a una nova ubicació: <code>ou=dam,dc=raul,dc=cat</code>.</li>
</ol>
<p>Entrada al <strong>ldif</strong>:</p>
<pre><code class="language-ldif">dn: uid=abergin,ou=People,dc=raul,dc=cat
changetype: moddn
newrdn: uid=abergin
deleteoldrdn: 1
newSuperior: ou=dam,dc=raul,dc=cat

dn: uid=achassin,ou=People,dc=raul,dc=cat
changetype: moddn
newrdn: uid=achassin
deleteoldrdn: 1
newSuperior: ou=dam,dc=raul,dc=cat

dn: uid=ahall,ou=People,dc=raul,dc=cat
changetype: moddn
newrdn: uid=ahall
deleteoldrdn: 1
newSuperior: ou=dam,dc=raul,dc=cat
</code></pre>
<p><img alt="moure usr" src="../img/3.79.png" /></p>
<p>Ara modificarem el <strong>LDAP</strong> amb la informació introduïda anteriorment amb la comanda <code>ldapmodify -x -D "cn=admin,dc=raul,dc=cat" -W -f mk.ldif</code>:</p>
<p><img alt="modify" src="../img/3.80.png" /></p>
<p>Finalment, anem a veure la <strong>UO</strong> de <strong>People</strong> i podem comprovar que ja no estan els primers tres usuaris que hi havia abans:</p>
<p><img alt="people" src="../img/3.81.png" /></p>
<p>I per últim, veiem que en la <strong>UO</strong> de <strong>DAM</strong> ja estan afegits els usuaris corresponents:</p>
<p><img alt="dam agregat" src="../img/3.82.png" />
<br><br></p>
<h4 id="esborra-la-uo-people">Esborra la UO People</h4>
<p>En aquest cas no borraré la meva <strong>UO People</strong> personalment, però seguidament hi haurà uns passos per explicar l'eliminació:</p>
<ul>
<li>Primer de tot, comprovem que la <strong>UO</strong> està completament buida fent una cerca amb la comanda <code>ldapsearch -xLLL -D "ou=People,dc=raul,dc=cat" dn</code>. Si no surt res, és que està buida. Si no està buida, hem d'introduir la següent entrada al fitxer <strong>ldif</strong> per eliminar un usuari i així fer-ho per cada usuari. Finalment, hem de fer <code>ldapmodify -x -D "cn=admin,dc=raul,dc=cat" -W -f mk.ldif</code>:</li>
</ul>
<pre><code class="language-ldif">dn: uid=usuari,ou=People,dc=raul,dc=cat
changetype: delete
</code></pre>
<ul>
<li>El segon pas sera elimar directament la <strong>UO</strong> amb la seguent entrada:    </li>
</ul>
<pre><code class="language-ldif">dn: ou=People,dc=raul,dc=cat
changetype: delete
</code></pre>
<ul>
<li>Finalment, comprovem que ja no estigui buscant-la amb <code>ldapsearch -xLLL -D "ou=People,dc=raul,dc=cat" dn</code>, i ja estaria eliminada.
<br><br></li>
</ul>
<h4 id="modifica-el-uid-de-lusuari-hmiller-a-hamiller">Modifica el uid de l'usuari hmiller a hamiller</h4>
<p>Abans de modificar res, primer de tot anem a comprovar el <strong>uid</strong> de l'usuari que se'ns demana amb la comanda <code>ldapsearch -xLLL -D "ou=People,dc=raul,dc=cat" "(uid=hmiller)"</code>, i trobem que sí existeix:</p>
<p><img alt="hmiller" src="../img/3.83.png" /></p>
<p>Seguidament, farem la modificació del <strong>uid</strong> amb la següent entrada al <strong>ldif</strong>:</p>
<pre><code class="language-ldif">dn: uid=hmiller,ou=People,dc=raul,dc=cat
changetype: moddn
newrdn: uid=hamiller
deleteoldrdn: 1
</code></pre>
<p>L'entrada es divideix en:</p>
<ol>
<li><strong><code>dn:</code></strong> Indica el DN de l'entrada a modificar (<code>uid=hmiller,ou=People,dc=raul,dc=cat</code>).</li>
<li><strong><code>changetype: moddn</code></strong> Especifica que es vol canviar el <strong>DN</strong>.</li>
<li><strong><code>newrdn:</code></strong> Defineix el nou RDN (<code>uid=hamiller</code>).</li>
<li><strong><code>deleteoldrdn:</code></strong> Elimina l'antic RDN després de la modificació.</li>
</ol>
<p>Entrada:</p>
<p><img alt="entrada" src="../img/3.84.png" /></p>
<p>Fem la modificació al <strong>LDAP</strong> amb <code>ldapmodify -x -D "cn=admin,dc=raul,dc=cat" -W -f mk.ldif</code>:</p>
<p><img alt="modify" src="../img/3.85.png" /></p>
<p>I finalment, tornem a comprovar que el <strong>uid</strong> hagi estat canviat a <code>hamiller</code>, igual que abans, amb la comanda <code>ldapsearch -xLLL -D "ou=People,dc=raul,dc=cat" "(uid=hamiller)"</code>:</p>
<p><img alt="hamiller" src="../img/3.86.png" />
<br><br></p>
<h4 id="dun-sol-cop-a-lusuari-que-tu-vulguis-esborra-un-atribut-afegeix-ne-un-altre-i-modifica-un-tercer">D’un sol cop, a l’usuari que tu vulguis, esborra un atribut, afegeix-ne un altre i modifica un tercer.</h4>
<p>Si mirem a la <strong>UO</strong> de <strong>DAM</strong>, trobarem tres usuaris. En aquest cas, utilitzarem l'usuari <strong>ahall</strong>:</p>
<p><img alt="dn ahall" src="../img/3.87.png" /></p>
<p>Informació de l'usuari <strong>ahall</strong>: </p>
<p><img alt="ahall" src="../img/3.88.png" /></p>
<p>Amb aquest usuari, el que farem serà eliminar-li l'atribut <code>roomNumber</code>, afegir-ne un altre que serà <code>description</code>, i finalment substituir el <code>telephoneNumber</code>.
Ho farem introduint la següent entrada de nou al <strong>LDIF</strong>:</p>
<pre><code class="language-ldif">dn: uid=ahall,ou=Dam,dc=raul,dc=cat
changetype: modify
delete: roomNumber

dn: uid=ahall,ou=Dam,dc=raul,dc=cat
add: description
description: Usuari ahall

dn: uid=ahall,ou=Dam,dc=raul,dc=cat
replace: telephoneNumber
telephoneNumber: +2 234 234 234
</code></pre>
<p><img alt="ahall" src="../img/3.91.png" /></p>
<p>Executem la comanda <code>ldapmodify -x -D "cn=admin,dc=raul,dc=cat" -W -f mk.ldif</code>:</p>
<p><img alt="ldapmodify" src="../img/3.90.png" /></p>
<p>Finalment, podem veure com el <code>roomNumber</code> s'ha eliminat, hem afegit la <code>description</code>, i finalment volíem reemplaçar el <code>telephoneNumber</code>, però s'ha afegit perquè no existia. Si hagués existit, s'hauria actualitzat correctament.</p>
<p><img alt="resultat" src="../img/3.92.png" /></p>
<hr />
<h2 id="4-entorns-grafics-apache-directory-studio">4. Entorns Gràfics (Apache Directory Studio)</h2>
<h3 id="installacio">Instal·lació</h3>
<p>Primer de tot, per fer la instal·lació hem d'anar a <code>https://directory.apache.org/studio/download/download.html</code> i descarregar el paquet de <strong>Apache Directory Studio</strong>.</p>
<p>Pàgina de descàrrega:  </p>
<p><img alt="web download" src="../img/3.99.png" /></p>
<p>Seguidament, podem comprovar que tenim el paquet descarregat a les nostres descàrregues:  </p>
<p><img alt="downloads" src="../img/3.100.png" /></p>
<p>Fem l'extracció de la carpeta i accedim on ja podrem veure l'executable de l'aplicació gràfica:  </p>
<p><img alt="extraer" src="../img/3.101.png" /></p>
<p>Hem d'instal·lar Java (JDK) perquè funcioni <strong>Apache</strong>. Per a una versió 11, l'instal·larem amb la següent comanda:<br />
<code>sudo apt install openjdk-11-jdk</code></p>
<p><img alt="java" src="../img/3.102.png" /></p>
<p>Finalment, executem l'aplicació:  </p>
<p><img alt="execució" src="../img/3.103.png" /></p>
<h3 id="configuracio">Configuració</h3>
<h4 id="1-connexio-a-un-servidor-ldap"><strong>1. Connexió a un servidor LDAP</strong></h4>
<p><strong>Afegir una connexió a un servidor LDAP</strong>  </p>
<ol>
<li>A la barra de menú, fem clic a <strong>Window</strong>, després a <strong>Open Perspective</strong> i <strong>Other...</strong>  </li>
</ol>
<p><img alt="perspective" src="../img/3.104.png" /></p>
<ul>
<li>Seleccionem <strong>LDAP</strong> i fem clic a <strong>Open</strong>.  </li>
</ul>
<p><img alt="open" src="../img/3.105.png" /></p>
<ul>
<li>Aquesta seria la perspectiva principal on podrem gestionar els nostres servidors LDAP i cercar entrades dins d'ells:  </li>
</ul>
<p><img alt="finestra" src="../img/3.106.png" /></p>
<ol>
<li>
<p>Ara, al panell esquerre, busquem el panell <strong>Connection</strong>.  </p>
</li>
<li>
<p>Si no es veu aquest panell, anem a <strong>Window</strong>, <strong>Show View</strong> i <strong>LDAP Connections</strong>.  </p>
<p><img alt="Connection" src="../img/3.107.png" /></p>
</li>
<li>
<p>Per afegir una nova connexió, fem clic a la icona <strong>New Connection</strong> (de color groc), anem al menú i seleccionem <strong>File</strong>, després <strong>New</strong> i <strong>LDAP Connection</strong>. Tindrem la següent finestra:  </p>
</li>
</ol>
<p><img alt="New Connection" src="../img/3.108.png" /></p>
<p><strong>Configuració de la connexió</strong>  </p>
<ol>
<li>
<p><strong>Introduïm les dades de la connexió</strong>:  </p>
</li>
<li>
<p><strong>Name</strong>: Un nom descriptiu per a la connexió (per exemple, "El meu servidor LDAP").</p>
</li>
<li><strong>Host</strong>: Adreça del servidor LDAP (per exemple, <code>localhost</code> si és la nostra màquina local).</li>
<li><strong>Port</strong>: El port per defecte és <strong>389</strong> per connexions no segures o <strong>636</strong> per connexions segures.</li>
<li><strong>Encryption</strong>: Si la connexió és segura, seleccionem <strong>LDAPS</strong> (això farà servir el port 636). Si no és segura, deixem l'opció per defecte a <strong>None</strong>.</li>
</ol>
<p><img alt="connexió" src="../img/3.109.png" /></p>
<ol>
<li>
<p><strong>Configuració d'autenticació</strong>:  </p>
</li>
<li>
<p>Configurem l'autenticació posant l'usuari administrador <code>dc=raul,dc=cat</code> i les seves dades.  </p>
</li>
<li>
<p>Fem clic a <strong>OK</strong> per desar la configuració. I tindríem la següent connexió:  </p>
</li>
</ol>
<p><img alt="perspective" src="../img/3.110.png" /></p>
<h4 id="2-configuracio-de-la-cerca-a-ldap"><strong>2. Configuració de la cerca a LDAP</strong></h4>
<p><strong>Realitzar una cerca</strong>  </p>
<ol>
<li>A la <strong>Vista del Navegador LDAP</strong>, seleccionem el servidor LDAP al qual ens hem connectat.  </li>
<li>Al panell central, fem clic dret sobre el servidor i seleccionem <strong>New Search</strong>:  </li>
</ol>
<p><img alt="new search" src="../img/3.111.png" /></p>
<ol>
<li>
<p>A la finestra de cerca:  </p>
</li>
<li>
<p><strong>Base DN</strong>: Defineix el punt de partida de la cerca (per exemple, <code>dc=raul,dc=cat</code>).</p>
</li>
<li><strong>Filter</strong>: Defineix un filtre de cerca (per exemple, <code>(uid=maria)</code> per cercar per l'atribut <code>uid</code>).  </li>
</ol>
<p>Fem clic a <strong>Search</strong> per executar la cerca:  </p>
<p><img alt="search" src="../img/3.112.png" /></p>
<p>Resultat de la cerca realitzada anteriorment:  </p>
<p><img alt="cerca" src="../img/3.113.png" /></p>
<h4 id="3-configuracio-de-preferencies-generals"><strong>3. Configuració de preferències generals</strong></h4>
<p><strong>Canviar el tema visual</strong>  </p>
<ol>
<li>Anem a <strong>Window</strong>, <strong>Preferences</strong>, <strong>General</strong>, <strong>Appearance</strong> i <strong>Theme</strong>.  </li>
<li>Seleccionem entre els temes disponibles, com el <strong>Dark Theme</strong> o el <strong>Light Theme</strong>.  </li>
</ol>
<p><img alt="temes" src="../img/3.115.png" /></p>
<p><strong>Canviar la font i la mida</strong>  </p>
<ol>
<li>A la mateixa secció de <strong>Appearance</strong>, podem configurar la mida de la font i el tipus de lletra que s'utilitzarà a les vistes de <strong>LDAP Browser</strong> i <strong>Schema Editor</strong>.  </li>
<li>Seleccionem <strong>Font</strong> per canviar el tipus de font i <strong>Size</strong> per ajustar la mida de la font:  </li>
</ol>
<p><img alt="font" src="../img/3.116.png" /></p>
<h3 id="comprovar-que-larbre-de-directori-es-correcte">Comprovar que l'arbre de directori és correcte</h3>
<p><strong>1. Configuració de la vista de l'arbre de directoris</strong>  </p>
<ul>
<li>Naveguem per l'arbre per veure com estan organitzades les dades. La jerarquia de l'arbre hauria de tenir una estructura lògica.  </li>
<li>Un cop configurat, podrem navegar fàcilment per l'arbre LDAP i veure els objectes i atributs.  </li>
<li>Fem clic sobre qualsevol entrada per veure les seves propietats, afegir o eliminar atributs, i més:  </li>
</ul>
<p><img alt="configuració" src="../img/3.114.png" /></p>
<p><strong>2. Validar els atributs de les entrades</strong>  </p>
<ul>
<li>Fem clic a una entrada del directori i revisem els atributs associats.  </li>
<li>Per exemple, una entrada d'usuari com <code>uid=abergin</code> hauria de tenir atributs com <code>cn</code>, <code>sn</code>, <code>uid</code>, <code>userPassword</code>...  </li>
<li>
<p>Si un atribut important falta o no es correspon amb la informació esperada, això podria indicar un error en l'estructura de l'arbre.  </p>
<p><img alt="validar" src="../img/3.118.png" /></p>
</li>
</ul>
<p><strong>3. Utilitzar el filtre de cerca per a validació ràpida</strong>  </p>
<ul>
<li>Podem utilitzar la funcionalitat de <strong>Quick Search</strong> dins d'Apache Directory Studio per filtrar entrades i veure si l'estructura es comporta correctament.  </li>
<li>
<p>També podem filtrar per <code>ou=Dam</code> per assegurar-nos que totes les entrades d'usuari estan a l'OU correcta.  </p>
<p><img alt="filtrar dam" src="../img/3.119.png" /></p>
<p>Resultat de la cerca:  </p>
<p><img alt="cerca" src="../img/3.120.png" /></p>
</li>
</ul>
<h3 id="crea-una-uo-un-grup-i-un-usuari">Crea una UO, un Grup i un Usuari</h3>
<h4 id="1-crear-una-unitat-organitzativa-ou"><strong>1. Crear una Unitat Organitzativa (OU)</strong></h4>
<p>Les <strong>Unitats Organitzatives (OU)</strong> s'utilitzen per organitzar les dades en l'arbre LDAP. </p>
<p><strong>Passos per crear una Unitat Organitzativa:</strong></p>
<ol>
<li>A la finestra de l'arbre de directori, naveguem fins al punt on volem crear la nova <strong>OU</strong>.</li>
<li>
<p>Fem clic dret sobre el directori on volem afegir la nova <strong>OU</strong> i seleccionem <strong>New Entry</strong>:</p>
<p><img alt="New Entry" src="../img/3.121.png" />  </p>
</li>
<li>
<p>A la finestra que surt, seleccionem <strong>Organizational Unit</strong> i clicquem a <strong>Next</strong>:</p>
<p><img alt="Organizational Unit" src="../img/3.122.png" /></p>
</li>
<li>
<p>Omplim els camps:</p>
<ul>
<li>En <strong>Parent</strong> posem: <code>dc=raul,dc=cat</code> que os es creara.</li>
<li>I en <strong>RDN</strong> fiquem <code>ou=sistemes</code></li>
</ul>
<p><img alt="camps" src="../img/3.123.png" /></p>
</li>
<li>
<p>Fem clic a <strong>Finish</strong> per crear la nova <strong>OU</strong>:</p>
<p><img alt="ou crear" src="../img/3.124.png" /></p>
</li>
</ol>
<p>Ara hem creat una nova <strong>OU</strong> per a emmagatzemar usuaris dins del nostre servidor LDAP.</p>
<p><img alt="ou" src="../img/3.125.png" /></p>
<h4 id="2-crear-un-grup"><strong>2. Crear un Grup</strong></h4>
<p>Els <strong>grups</strong> s'utilitzen per organitzar els usuaris en el servidor LDAP. Els usuaris dins d'un grup poden tenir permisos comuns o ser tractats com una unitat.</p>
<p><strong>Passos per crear un grup:</strong></p>
<ol>
<li>A la finestra de l'arbre de directori, seleccionem la <strong>OU</strong> on volem crear el grup (per exemple, <code>ou=sistemes,dc=raul,dc=cat</code>).</li>
<li>Fem clic dret sobre l'OU i seleccionem <strong>New</strong>, <strong>Other</strong> i <strong>Entry</strong>.</li>
<li>
<p>A la finestra, seleccionem <strong>Group Of Names</strong> i cliquem <strong>Next</strong>.</p>
<p><img alt="group of names" src="../img/3.126.png" /></p>
</li>
<li>
<p>Omplem els camps necessaris:</p>
<ul>
<li>
<p><strong>DN (Distinguished Name)</strong>: Per exemple, <code>cn=grup_admin,ou=sistemes,dc=example,dc=com</code>.</p>
<p><img alt="dn" src="../img/3.127.png" /></p>
</li>
<li>
<p><strong>CN (Common Name)</strong>: Per exemple, <code>grup_admins</code>.</p>
</li>
<li><strong>Description</strong>: (Es opcional) Una breu descripció del grup, com "Grup amb permisos admin".</li>
</ul>
<p><img alt="description" src="../img/3.129.png" /></p>
</li>
<li>
<p>Afegir membres al grup:</p>
<ul>
<li>
<p>Si volem afegir membres seleccionem l'atribut <code>member</code> i afegim els <strong>DN</strong> dels usuaris que volem que formin part del grup (per exemple, <code>uid=admin,ou=usuaris,dc=example,dc=com</code>).</p>
<p><img alt="member" src="../img/3.129.png" /></p>
</li>
</ul>
</li>
<li>
<p>Fem clic a <strong>Finish</strong> per crear el grup.</p>
</li>
</ol>
<p>Ara ja tenim un grup creat al directori, amb els usuaris que seleccionem com a membres.</p>
<p><img alt="grup" src="../img/3.130.png" /></p>
<h4 id="3-crear-un-usuari"><strong>3. Crear un Usuari</strong></h4>
<p>Un cop tinguem la nostra <strong>OU</strong> i <strong>grup</strong> creats, podem afegir-hi un <strong>usuari</strong>. Un usuari en LDAP es defineix amb un conjunt d'atributs com <code>uid</code>, <code>cn</code>, <code>sn</code>, <code>userPassword</code>...</p>
<p><strong>Passos per crear un usuari:</strong></p>
<ol>
<li>A la finestra de l'arbre de directori, seleccionem la <strong>OU</strong> que hem creat prèviament per a usuaris (per exemple, <code>ou=sistemes,dc=raul,dc=cat</code>).</li>
<li>Fem clic dret sobre l'OU i seleccionem <strong>New</strong>, <strong>Other</strong> i <strong>Entry</strong>.</li>
<li>A la finestra, seleccionem <strong>Person</strong> i cliquem <strong>Next</strong>.</li>
</ol>
<p><img alt="person" src="../img/3.135.png" /><br><br></p>
<ol>
<li>
<p>Omplim els camps necessaris:</p>
<ul>
<li><strong>DN (Distinguished Name)</strong>: Per exemple, <code>uid=maria,ou=sistemes,dc=raul,dc=cat</code>.</li>
<li><strong>UID (User ID)</strong>: Per exemple, <code>maria</code>:</li>
</ul>
<p><img alt="nom maria" src="../img/3.136.png" /></p>
<ul>
<li><strong>CN (Common Name)</strong>: Per exemple, <code>Maria M</code>.</li>
<li><strong>SN (Surname)</strong>: Per exemple, <code>Diaz</code>.</li>
<li><strong>UserPassword</strong>: Assignem una contrasenya per a l'usuari.</li>
</ul>
<p><img alt="info" src="../img/3.137.png" /><br><br></p>
</li>
<li>
<p>Si volem afegir l'usuari a un grup, afegim el <strong>DN del usuari</strong><br />
   (per exemple, <code>uid=maria,ou=sistemes,dc=raul,dc=cat</code>) com a <strong>membre</strong> del grup.<br />
   Fem clic a <strong>Finish</strong> per crear l'usuari amb tota l'informació:</p>
</li>
</ol>
<p><img alt="usuari maria" src="../img/3.138.png" /><br><br></p>
<h3 id="accedir-des-del-client-amb-aquest-usuari"><strong>Accedir des del client amb aquest usuari</strong></h3>
<p>Per accedir des del client a un servidor LDAP amb un <strong>usuari</strong> creat, cal que utilitzem <strong>Apache Directory Studio</strong> o un altre client LDAP i configurem la connexió amb la informació adequada.</p>
<h4 id="1-configuracio-de-la-connexio"><strong>1. Configuració de la connexió</strong></h4>
<p>Necessitem configurar una connexió a un servidor LDAP per poder validar amb l'usuari:</p>
<ol>
<li>
<p><strong>Crear una nova connexió LDAP</strong>:</p>
<ul>
<li>A la part esquerra a la finestra de <strong>LDAP Browser</strong>, fem clic a <strong>New Connection</strong> per crear una nova connexió.</li>
</ul>
</li>
<li>
<p><strong>Afegim els detalls de la connexió</strong>:</p>
<ul>
<li><strong>Servidor</strong>: Introduïm la <strong>IP o nom del servidor LDAP</strong> (per exemple, <strong><code>localhost</code></strong>). </li>
<li><strong>Port</strong>: Per defecte, els servidors LDAP utilitzen el <strong>port 389</strong>.</li>
</ul>
<p><img alt="conexió" src="../img/3.139.png" /></p>
</li>
<li>
<p><strong>Autenticació</strong>:</p>
<ul>
<li>En aquesta pantalla, podem especificar les nostres credencials d'autenticació.</li>
<li>En el <strong>DN d'autenticació</strong> hem d'introduir el <strong>DN complet de l'usuari</strong> amb el qual volem autenticar-nos.<br />
  Per exemple: <code>uid=maria,ou=sistemes,dc=raul,dc=cat</code></li>
<li>A <strong>contrasenya</strong> introduïm la contrasenya que vam assignar a l'usuari quan el vam crear.<br />
  En el nostre cas <strong>Contrasenya</strong>: <code>maria</code></li>
</ul>
<p><img alt="autentication" src="../img/3.140.png" /></p>
</li>
<li>
<p><strong>Provem la connexió</strong>:</p>
<ul>
<li>Fem clic a <strong>Test Connection</strong> per comprovar si la connexió és correcta.<br />
  Si tot està configurat correctament, hauríem de veure un missatge de <strong>"Connexió exitosa"</strong>.</li>
</ul>
<p><img alt="conexió" src="../img/3.141.png" /></p>
</li>
</ol>
<h4 id="2-validar-usuari"><strong>2. Validar usuari</strong></h4>
<p>Un cop configurada la connexió, podem intentar validar l'usuari i comprovar si podem realitzar operacions en el servidor LDAP.</p>
<p><strong>Comprovar l'arbre de directori</strong>:</p>
<ul>
<li>
<p>Si la connexió és correcta i la validació de l'usuari ha estat exitosa, podrem veure l'arbre de directori de l'LDAP des de <strong>Apache Directory Studio</strong>.</p>
</li>
<li>
<p>Amb l'usuari <strong>admin</strong> amb permisos, sí que ens deixa modificar les dades de l'usuari:</p>
<p><img alt="admin" src="../img/3.142.png" /></p>
</li>
<li>
<p>Però amb els permisos de <strong>maria</strong>, no ens deixa modificar-les ja que no és administradora:</p>
<p><img alt="maria" src="../img/3.143.png" /></p>
</li>
</ul>
<hr />
<h2 id="5-servidor-nfs">5. Servidor NFS</h2>
<p>Un servidor NFS i un servidor Samba serveixen per compartir recursos, però tenen diferències en l'autenticació.</p>
<p>NFS autentica a nivell de màquina (host), però pot fer-ho també a nivell d'usuari, tot i que és més complex.</p>
<p>Samba, en canvi, autentica a nivell d'usuari i és més flexible, permetent integrar-se amb sistemes com Active Directory, fet que el fa millor per a entorns amb usuaris diversos.</p>
<h3 id="installacio-i-configuracio-servidors-ldap">Instal·lació i configuració servidors LDAP</h3>
<p>Per començar amb la instal·lació, primer de tot hem de descarregar <strong>nfs-kernel-server</strong>, que és el paquet que permet configurar i gestionar un servidor NFS a Linux per compartir directoris a través de la xarxa.</p>
<p><strong>Descarrega de nfs-kernel-server:</strong></p>
<p><img alt="nfs-kernel-server" src="../img/3.144.png" /></p>
<p>Una vegada instal·lat el paquet, hem de crear una carpeta anomenada <strong>compartida</strong>, que és la que utilitzarem per veure el seu contingut en diferents màquines.</p>
<p>També hem de donar permisos de <code>chmod -R 777</code>, que són permisos de lectura, escriptura i execució a tots els usuaris per a tots els fitxers.</p>
<p><strong>Creació de "compartida" i permisos:</strong></p>
<p><img alt="comartida" src="../img/3.145.png" /></p>
<p>Seguidament, hem de configurar la carpeta <strong>compartida</strong>. Per fer-ho, hem d'accedir al fitxer <code>/etc/exports</code> i afegir una última línia amb el següent contingut:</p>
<p><code>/compartida *(rw,sync,no_subtree_check)</code>, es divideix en el següent:</p>
<ul>
<li><strong>/compartida</strong>: Directori a compartir.</li>
<li><strong>*</strong>: Tots els clients poden accedir; si no, hauríem de posar la <strong>IP</strong>.</li>
<li><strong>rw</strong>: Permet lectura i escriptura.</li>
<li><strong>sync</strong>: Les operacions són sincronitzades.</li>
<li><strong>no_subtree_check</strong>: No comprova la consistència dels subdirectoris.</li>
</ul>
<p><img alt="exports" src="../img/3.146.png" /></p>
<p>Després d'haver guardat els canvis de l'anterior fitxer, hem de fer un <strong>Restart</strong> dels serveis <strong>NFS</strong>, sempre amb <code>systemctl restart nfs-kernel-server</code>:</p>
<p><img alt="compartida" src="../img/3.147.png" /></p>
<h3 id="installacio-i-configuracio-del-client-windows-11">Instal·lació i configuració del client Windows 11</h3>
<p>Primer de tot, hem de configurar el <strong>NFS</strong> de <strong>Windows 11</strong>. Per fer-ho, s'ha d'anar a <strong>Panell de Control</strong> -&gt; <strong>Programes i característiques</strong>. Una vegada en aquesta finestra, hem d'anar a la part esquerra i entrar on indica <strong><em>Activar o Desactivar les característiques de Windows</em></strong>.</p>
<p>Una vegada tenim la nova finestra oberta, hem de buscar i habilitar l'opció de <strong>Serveis per a NFS</strong>:</p>
<p><strong>Habilitar l'opció:</strong></p>
<p><img alt="nfs windows" src="../img/3.148.png" /></p>
<p><strong>Opció habilitada:</strong></p>
<p><img alt="nfs windows" src="../img/3.149.png" /></p>
<h4 id="compartir-carpeta-a-windows-11">Compartir carpeta a Windows 11</h4>
<p>Ara és el moment de fer la compartició des de <strong>Ubuntu</strong> cap al client de <strong>Windows 11</strong>.</p>
<p>En primer lloc, comprovem la <strong>IP</strong> de la nostra màquina <strong>Ubuntu</strong>:</p>
<p><img alt="ip a" src="../img/3.150.png" /></p>
<pre><code>IP: 10.0.2.15
</code></pre>
<p>Seguidament, anem a l'<strong>Explorador d'arxius</strong> de Windows i hem de copiar la nostra direcció de la màquina <strong>Ubuntu</strong>, on és la carpeta compartida, seguit del nom de la carpeta (<strong>compartida</strong>).</p>
<p>S'ha de fer de la següent manera: <code>\\10.0.2.15\compartida</code></p>
<p><img alt="carpeta compartida Windows" src="img/3.X.png" /></p>
<p>I ja tindríem la carpeta compartida visible en el nostre client de <strong>Windows 11</strong>.</p>
<p>(Provar de crear un nou fitxer a Ubuntu i visualitzar-lo a Windows).</p>
<h3 id="installacio-i-configuracio-del-client-a-ubuntu">Instal·lació i configuració del client a Ubuntu</h3>
<p>Per començar, el primer que hem de fer és instal·lar el paquet <code>nfs-common rpcbind</code>, que 
proporciona les eines necessàries per muntar i utilitzar sistemes de fitxers 
<strong>NFS</strong>, i <strong>rpcbind</strong> gestiona les connexions <strong>RPC</strong> (Remote Procedure Calls) requerides per <strong>NFS</strong>.</p>
<p><img alt="Instal·lació nfs-common" src="../img/3.151.png" /></p>
<p>Seguidament, creem una carpeta anomenada <strong>nfs</strong> al directori <code>/home/raul</code>. Un cop creada, li donem permisos de lectura, escriptura i execució per a tots els usuaris (propietari, grup i altres) de manera recursiva.</p>
<p><img alt="creacio carpeta" src="../img/3.153.png" /></p>
<p>Un cop fets els passos anteriors, muntem el directori <code>/compartida</code> del servidor <strong>10.0.2.15</strong> a la carpeta <code>/home/raul/nfs</code>, permetent accedir als seus fitxers com si fossin locals.</p>
<p><img alt="Muntatge" src="../img/3.154.png" /></p>
<p>Després, entrem a la carpeta creada i creem un fitxer per després poder veure'l a <code>/compartida</code> i també ho fem a la inversa per veure que la compartició s'ha fet correctament:</p>
<p><img alt="comprovació compartida" src="../img/3.155.png" /></p>
<h3 id="perfils-mobils-a-ubuntu">Perfils mobils a Ubuntu</h3>
<h4 id="samba"><strong>SAMBA</strong></h4>
<p>A diferència de NFS, el servidor <strong>Samba</strong> permet l’autenticació a nivell d’usuari.<br />
També permet compartir més recursos que no només carpetes, com ara impressores, i pot treballar conjuntament amb <strong>LDAP</strong> per utilitzar els usuaris per a la validació.<br />
Admet clients tant de Linux com de Windows, i al servidor no s'hi pot connectar directament un equip o una xarxa, però es poden permetre convidats.  </p>
<h5 id="servidor"><strong>Servidor:</strong></h5>
<p>Primer de tot, ens connectarem a una màquina virtual que farà de <strong>Servidor</strong>.<br />
Seguidament, el que farem serà instal·lar <strong>Samba</strong>, com es mostra a continuació:  </p>
<p><img alt="instal·lar samba" src="../img/3.156.png" />  </p>
<p>Un cop instal·lat, hem de tenir una carpeta creada a l'arrel que es digui <strong>perfils</strong>, amb permisos complets per a tots els usuaris i grups:  </p>
<p><img alt="perfils" src="../img/3.157.png" />  </p>
<p>En aquest punt, li hem de donar tots els permisos que necessitem per a la carpeta <strong>perfils</strong> dins la configuració de <strong>Samba</strong>.<br />
Per fer-ho, hem d'anar al fitxer <code>/etc/samba/smb.conf</code> i, un cop dins, hem d'incloure les següents línies al final:  </p>
<ul>
<li><strong>[perfils]</strong>: Nom del recurs compartit.  </li>
<li><strong>path = /perfils</strong>: Indica la ruta de la carpeta compartida.  </li>
<li><strong>guest ok = yes</strong>: Permet l’accés sense autenticació.  </li>
<li><strong>directory mask = 0755</strong>: Estableix permisos de lectura i execució per a tothom, però només escriptura pel propietari.  </li>
<li><strong>create mask = 0644</strong>: Els fitxers nous tindran permisos de lectura per a tothom, però només escriptura pel propietari.  </li>
<li><strong>browseable = yes</strong>: La carpeta compartida serà visible als clients.  </li>
<li><strong>read list = @dam</strong>: Els usuaris del grup "dam" només poden llegir.  </li>
<li><strong>write list = raulM</strong>: L'usuari "raulM" té permís d’escriptura.  </li>
<li><strong>invalid users = enric</strong>: L'usuari "enric" no té accés a aquesta compartició.  </li>
</ul>
<p><img alt="conf" src="../img/3.172.png" />  </p>
<p>A continuació, reiniciem els serveis de <strong>Samba</strong>:  </p>
<p><img alt="restart" src="../img/3.159.png" />  </p>
<p>Ara hem d’afegir els usuaris <strong>raulM</strong>, <strong>enric</strong> i <strong>walid</strong>. Els crearem, però no tindran cap <strong>home</strong> assignada.  </p>
<p><img alt="usuaris" src="../img/3.160.png" />  </p>
<p>Comprovació que tenim els usuaris agregats al sistema:  </p>
<p><img alt="usuaris" src="../img/3.161.png" />  </p>
<p>Seguidament, afegim aquests usuaris al grup <strong>dam</strong> i comprovem que s'hagin afegit correctament al grup de la següent manera:  </p>
<p><img alt="dam" src="../img/3.162.png" />  </p>
<p>Amb la comanda <code>smbpasswd -a</code>, afegim un nou usuari al sistema de <strong>Samba</strong>, així que ho farem amb cadascun dels que hem creat prèviament:  </p>
<p><img alt="smbpasswd" src="../img/3.163.png" />  </p>
<h5 id="client"><strong>Client:</strong></h5>
<p>En aquest punt, ja tenim configurat el servidor, així que ens anem a una altra màquina virtual que actuarà com a <strong>Client</strong>.<br />
En aquesta màquina, instal·larem el paquet <code>smbclient</code> de la següent manera:  </p>
<p><img alt="smbclient" src="../img/3.164.png" />  </p>
<p>I, un cop estigui instal·lat, anirem als fitxers del nostre sistema, anirem a <strong>Otras ubicaciones</strong>, i en la barra de baix ens connectarem al <strong>Servidor</strong> posant la <strong>IP</strong> del <strong>Server</strong> amb el nom de la carpeta, ho farem de la següent manera:  </p>
<p><img alt="ip" src="../img/3.165.png" />  </p>
<p>Quan entrem, ens sortirà l'opció per connectar-nos. Si ens connectem amb l'usuari <strong>raulM</strong>, veurem que ens deixa accedir perfectament:  </p>
<p><img alt="raulM" src="../img/3.171.png" />  </p>
<p>I, un cop dins, podem crear una carpeta, ja que tenim tots els permisos per fer-ho sense problema:  </p>
<p><img alt="raulM" src="../img/3.170.png" />  </p>
<p>Ara, si ens connectem amb l'usuari <strong>walid</strong>, ens hi deixarà entrar, però en el moment que vulguem crear una carpeta ens donarà un error, ja que aquest usuari no té permisos per crear res, només té permís per veure què hi ha:  </p>
<p><img alt="walid" src="../img/3.167.png" />  </p>
<p>I finalment, si ens connectem amb un usuari que no té permisos per accedir, el que passarà és que no podrà accedir de cap manera, tal com hauria de ser:  </p>
<p><img alt="enric" src="../img/enric.png" />  </p>
<h4 id="nfs"><strong>NFS</strong></h4>
<p>NFS (<strong>Network File System</strong>) permet als usuaris accedir als seus fitxers des de qualsevol ordinador de la xarxa, ja que aquests s'emmagatzemen en un servidor 
central. Això és útil perquè el directori <code>/home</code> de cada usuari no estigui en un sol equip, sinó disponible a qualsevol dispositiu de la xarxa. 
D’aquesta manera, les dades es mantenen accessibles i segures sense dependre d’una sola màquina.</p>
<p>Començarem per connectar-nos a la màquina virtual que farà de servidor i després a la que farà de client. </p>
<h5 id="server"><strong>Server</strong></h5>
<p>Una vegada estem al servidor, hem d'instal·lar un paquet amb la comanda <code>apt install nfs-kernel-server</code>:</p>
<p><img alt="kernel-server" src="../img/168.png" />  </p>
<p>Seguidament, hem d'anar a l'arrel i allí hem de crear la carpeta anomenada <strong>perfils</strong> i l'hi hem de donar permisos perquè tothom pugui accedir-hi. Després mirem que tingui tots els permisos correctament:</p>
<p><img alt="perfils" src="../img/169.png" />  </p>
<p>Una vegada tenim la carpeta configurada, hem d'anar al fitxer <code>/etc/exports</code> i hem d'afegir la següent línia perquè totes les direccions puguin accedir al directori <strong>/perfils</strong>:</p>
<p><img alt="exports" src="../img/170.png" />  </p>
<p>Restaurem els serveis de <code>nfs-kernel-server</code>:</p>
<p><img alt="restart" src="../img/171.png" /> </p>
<p>Ara és moment de crear el grup anomenat <strong>Dam</strong>, per fer-ho tenim el següent fitxer anomenat <strong>grup.ldif</strong>. Dins del fitxer hem d'afegir la informació del grup i de l'usuari <strong>alu54</strong>, que pertanyerà al grup.</p>
<p>Informació del grup:</p>
<p><img alt="grup" src="../img/172.png" /> </p>
<p>Seguidament, amb el fitxer <strong>usu.ldif</strong>, afegim l'usuari <strong>alu54</strong> amb la seva contrasenya <strong>alu54</strong> i amb tota la seva informació, canviant el <strong>uidNumber</strong> a <strong>1101</strong>, ja que el <strong>1100</strong> és el del grup <strong>dam</strong>: </p>
<p><img alt="usr" src="../img/173.png" /> </p>
<p>Una vegada editada la informació dels fitxers, hem de carregar-la a l'<strong>ldap</strong> com es mostra a continuació:</p>
<p><img alt="ldapadd" src="../img/174.png" /> </p>
<h5 id="client_1"><strong>Client</strong></h5>
<p>Una vegada configurat el servidor, anem a configurar la màquina virtual del client.
En aquest, hem d'instal·lar el paquet <code>nfs-common rpcbind</code>, que, com es pot veure, en aquest cas ja està instal·lat a la seva versió més recent.</p>
<p><img alt="rpcbind" src="../img/175.png" /> </p>
<p>Ara creem una carpeta a l'arrel anomenada <strong>perfils</strong>, com es va fer en el servidor, però poden tenir noms diferents. Donem permisos a la carpeta i mirem que s'hagin afegit:</p>
<p><img alt="perfils" src="../img/176.png" /> </p>
<p>Finalment, al fitxer <code>/etc/fstab</code> hem d'afegir l'última línia, que serà la <strong>IP</strong> del servidor seguida del nom de la carpeta del servidor <strong>/perfils</strong>, i després la del client, que s'anomena igual (<strong>/perfils</strong>):</p>
<p><img alt="fstab" src="../img/177.png" /> </p>
<p>Una vegada tenim tots els canvis guardats, reiniciem la màquina del client i accedim amb l'usuari <strong>alu54</strong> i la seva contrasenya <strong>alu54</strong>. Hauríem de poder accedir correctament i, si afegim un fitxer a la carpeta compartida, s'ha de veure actualitzat al <strong>Server</strong>.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../sprint2/" class="btn btn-neutral float-left" title="Sprint 2"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../sprint4/" class="btn btn-neutral float-right" title="Sprint 4">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../sprint2/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../sprint4/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
